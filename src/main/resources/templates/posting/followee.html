<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Followee</title>
</head>
<body>
<!-- 내가 follow 중 -->
<h1><span th:text="${user.userName}"></span>님의 Followee</h1>
<!--<p th:text="${user.followers}"></p>-->
<div th:each = "follow : ${user.followees}">
    <div th:each="img : ${follow.followees.userImgs}">
        <img th:src="${img.prfImgUrl}" alt="프로필 사진" width="100" style="border-radius: 50%; object-fit: cover;">
    </div>
    <p th:text="${follow.followees.userName}"></p>
    <p th:text="${follow.followees.userEmail}"></p>
    <button class="followeeBtn"
            th:data-follower="${user.userId}"
            th:data-followee="${follow.followees.userId}">언팔로우</button>
</div>
</body>

<script>
    const followeeBtns = document.querySelectorAll(".followeeBtn");
    const USER_ID = '[[${user.userId}]]';

    followerBtns.forEach(button => {
        button.addEventListener("click",async function(){
            const followerId = this.dataset.follower;
            const followeeId = this.dataset.followee;
            const url = `/posting/${USER_ID}/followee.do`; // 백틱!!!!

            const response = await fetch(url,{method:'DELETE',
                headers: {'Content-Type': 'application/json'},
                body : JSON.stringify({
                    followerId: followerId,
                    followeeId: followeeId
                })
            });
            if (response.ok){
                alert("언팔로우 성공");
                this.closest('div').remove();
            }
        });
    });


</script>

</html>